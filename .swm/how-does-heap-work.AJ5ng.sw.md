---
id: AJ5ng
name: How Does Heap Work?
file_version: 1.0.2
app_version: 0.9.1-1
file_blobs:
  swimm.config.js: 0451ddd2b7da0ded9e20c21a2b27b9950b8aa9e5
  src/theme/Footer.js: f422471de05ac9b62e8a2a612ebe3a2f6c5c66a1
---

Heap Is Currently Kind Of Messy.
--------------------------------

Originally, we wanted to load heap through Google Tag Manager as described in [SEO Plugin Configuration](seo-plugin-configuration.faNzX.sw.md), however, we could not (for reasons that are yet to be understood) get heap to actually fire on the page, even when the code was obviously there.

To get around that, we're loading it **synchronously** in the footer through an ad-hoc component we call by wrapping the theme/Footer component that actually runs the heap code in the browser. Why the footer? Because right now, the Docusaurus header is a very steady moving target and even wrapping it could cause problems.

How Do I Turn Heap On Or Off?
-----------------------------

If that's all you need to do, see below, and you can skip the rest of this document.

<br/>

Edit the Swimm config, and in `heap`[<sup id="1hXtI7">â†“</sup>](#f-1hXtI7) set `enabled`[<sup id="2hlK3e">â†“</sup>](#f-2hlK3e) to `false` if you want to turn it off, or `true` if you want to turn it on. A build is required for the change to go live.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ swimm.config.js
```javascript
â¬œ 11             release: ':exclamation:  :ocean::ship::swimmer::rocket::new::boom::tada::sparkles:',
â¬œ 12             video: ':movie_camera::clapper::cinema:',
â¬œ 13         },
ðŸŸ© 14         heap: {
ðŸŸ© 15              enabled: false,
ðŸŸ© 16             id: '2760903549',
ðŸŸ© 17             params: [
ðŸŸ© 18                 "addEventProperties", 
ðŸŸ© 19                 "addUserProperties", 
ðŸŸ© 20                 "clearEventProperties", 
ðŸŸ© 21                 "identify", 
ðŸŸ© 22                 "resetIdentity", 
ðŸŸ© 23                 "removeEventProperty", 
ðŸŸ© 24                 "setEventProperties", 
ðŸŸ© 25                 "track", 
ðŸŸ© 26                 "unsetEventProperty"
ðŸŸ© 27             ]
ðŸŸ© 28         }
â¬œ 29     }
â¬œ 30     
â¬œ 31     export {SiteSettings};
```

<br/>

How is Heap actually sent to the browser and run?
-------------------------------------------------

To avoid swizzling theme components during the Docusaurus2 beta, we define a new footer component that just wraps the standard footer component. This happens in `ðŸ“„ src/theme/Footer.js`, which Docusaurus knows to load in lieu of the standard footer component:

<br/>

We can't import Footer from Footer because to understand recursion is to understand recursion, so we just grab a reference copy of the original `@theme-original/Footer` as `OrginalFooter`.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/theme/Footer.js
```javascript
ðŸŸ© 1      import OriginalFooter from '@theme-original/Footer';
â¬œ 2      import React from 'react';
```

<br/>

Then, we present the original theme footer through the reference we made, and if (and only if) we're running in a browser do we actually run the code via `<HeapAnalytics>`.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/theme/Footer.js
```javascript
â¬œ 30         return null;
â¬œ 31     }
â¬œ 32     
ðŸŸ© 33     export default function Footer(props) {
ðŸŸ© 34         const isBrowser = useIsBrowser();
ðŸŸ© 35         return (
ðŸŸ© 36             <>
ðŸŸ© 37             <OriginalFooter {...props} />
ðŸŸ© 38             {isBrowser && <HeapAnalytics />}
ðŸŸ© 39             </>
ðŸŸ© 40         );
ðŸŸ© 41     }
```

<br/>

Why is this icky, and what will change?
---------------------------------------

We should just load Heap through `<script>` tags in the header like anything else, and also be able to control events and stuff from the configuration. It's a very simple plugin to write in order to accomplish this, but we'll do that during a cool-down cycle.

<br/>

<!-- THIS IS AN AUTOGENERATED SECTION. DO NOT EDIT THIS SECTION DIRECTLY -->
### Swimm Note

<span id="f-2hlK3e">enabled</span>[^](#2hlK3e) - "swimm.config.js" L15
```javascript
         enabled: false,
```

<span id="f-1hXtI7">heap</span>[^](#1hXtI7) - "swimm.config.js" L14
```javascript
    heap: {
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBZG9jcy5zd2ltbS5pbyUzQSUzQXN3aW1taW8=/docs/AJ5ng).